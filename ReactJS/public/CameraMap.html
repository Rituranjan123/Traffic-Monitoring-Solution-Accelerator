<!DOCTYPE html>
<html lang="en">
<head>
    <title>Filling in an Address Form - Bing Maps Samples</title>

    <meta charset="utf-8" />
	<link rel="shortcut icon" href="/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="This example shows how to use the selected result from the default autosuggest UI to fill in an address form." />
    <meta name="keywords" content="Microsoft maps, map, gis, API, SDK, Bing, Bing Maps, autosuggest" />
    <meta name="author" content="Microsoft Bing Maps" />
    <meta name="screenshot" content="bmv8-autosuggestaddressform.jpg" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    
    <script>
         var map;
         var pinInfobox;
    function GetMap() {
        debugger;
        var pushpinInfos = [];
        pushpinInfos[0] = { 'redirectUrl':'./#/Dashboard/41','lat': 31.82296210674898, 'lng': 84.1900683034569, 'title': 'Camera 1', 'description': 'Washington', 'icon' :'http://icons.iconarchive.com/icons/icons-land/vista-map-markers/24/Map-Marker-Marker-Outside-Chartreuse-icon.png' };
        pushpinInfos[1] = {'redirectUrl':'/#/Dashboard/40', 'lat': 33.59000000, 'lng': -86.92000000, 'title': 'Camera 2', 'description': 'New york ', 'icon' :'http://icons.iconarchive.com/icons/icons-land/vista-map-markers/24/Map-Marker-Marker-Outside-Chartreuse-icon.png' };      
      
		var infoboxLayer = new Microsoft.Maps.EntityCollection();
        var pinLayer = new Microsoft.Maps.EntityCollection();
        var apiKey = 'AuU1ciWa-v2D4MXrLhXxgbVY6676TOmemFJ3LpCO52P5Mnx8_KIdez1M7G2j0ZIN';
        var curPos = new Microsoft.Maps.Location(33.59000000,   -86.92000000);
        var mapOptions = {
          credentials: 'AuU1ciWa-v2D4MXrLhXxgbVY6676TOmemFJ3LpCO52P5Mnx8_KIdez1M7G2j0ZIN',
          center: curPos,
          mapTypeId: Microsoft.Maps.MapTypeId.road,
          zoom: 7
      };
        var map = new window.Microsoft.Maps.Map('#myMap',mapOptions);
        //var map = new Microsoft.Maps.Map(document.getElementById("myMap"), { credentials: apiKey });
        // Create the info box for the pushpin
        pinInfobox = new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0, 0), { visible: false });
        infoboxLayer.push(pinInfobox);
        var locs = [];
        for (var i = 0 ; i < pushpinInfos.length; i++) {
            locs[i] = new Microsoft.Maps.Location(pushpinInfos[i].lat, pushpinInfos[i].lng);
            var pin = new Microsoft.Maps.Pushpin(locs[i], {icon: pushpinInfos[i].icon, width:'20px', height:'20px'});
            pin.Title = pushpinInfos[i].title;
            pin.Description = pushpinInfos[i].description;
			pin.redirectUrl = pushpinInfos[i].redirectUrl;
            pinLayer.push(pin); 
            Microsoft.Maps.Events.addHandler(pin, 'click', displayInfobox);
        }
        map.entities.push(pinLayer);
        map.entities.push(infoboxLayer);
        var bestview = Microsoft.Maps.LocationRect.fromLocations(locs);
        map.setView({ center: bestview.center, zoom: 3 });
    }
    function setCookie(name,value,expires){
        document.cookie = name + "=" + value + ((expires==null) ? "" : ";expires=" + expires.toGMTString())
    }

    function displayInfobox(e) {
            let CameraDetails={};
            CameraDetails['longitude']=e.location.longitude
            CameraDetails['latitude']=e.location.latitude
            CameraDetails['description']=e.target.Description
            CameraDetails['title']=e.target.title;
            let jsonstring=JSON.stringify(CameraDetails);
            var expirydate=new Date();
            expirydate.setTime( expirydate.getTime()+(100*60*60*24*100) )
            setCookie('CameraDetails',jsonstring,expirydate)
		   window.open(e.target.redirectUrl);
          //window.open(e.target.redirectUrl,"_self")

        //pinInfobox.setOptions({ title: e.target.Title, description: e.target.Description, visible: true, offset: new Microsoft.Maps.Point(0, 25) });
        //pinInfobox.setLocation(e.target.getLocation());
    }
    function hideInfobox(e) {
        pinInfobox.setOptions({ visible: false });
    }
    </script>
    
  
</head>
<body>   
    <script>
        // Dynamic load the Bing Maps Key and Script
        // Get your own Bing Maps key at https://www.microsoft.com/maps
        (async () => {
            let script = document.createElement("script");
            let bingKey ='AuU1ciWa-v2D4MXrLhXxgbVY6676TOmemFJ3LpCO52P5Mnx8_KIdez1M7G2j0ZIN'// await fetch("https://samples.azuremaps.com/api/GetBingMapsKey").then(r => r.text()).then(key => { return key });
            script.setAttribute("src", `https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=${bingKey}`);
            document.body.appendChild(script);
        })();
        debugger;

        function loadDeferredIframe() {
            let paramsURL = (new URL(document.location)).searchParams;
            let params = paramsURL.get("id");

            if(params){
                debugger;
                
               
                var srclive='';
                    if(params=='40'){  
                        ShowCameraDetails();                  
                        srclive='http://20.102.33.84:5000/'
                    }
                    else if(params=='41'){    
                        ShowCameraDetails();                
                        srclive='http://localhost/index41.html'
                    }    
                    else{
                        document.getElementById("myH1").style.display = "hide";
                        srclive='http://localhost/index0.html'
                    }
                document.getElementById("iframeid").src=srclive
           
            }
        }

        function ShowCameraDetails(){
            document.getElementById("cameradetails").style.display = "block";

            let CameraDetails=JSON.parse(getCookie('CameraDetails'));
                document.getElementById("latitude").innerHTML =CameraDetails.latitude
                document.getElementById("longitude").innerHTML =CameraDetails.longitude
                document.getElementById("description").innerHTML =CameraDetails.description
                document.getElementById("title").innerHTML =CameraDetails.title
               
        }

function getCookie(name) {
   var cookieName = name + "="
   var docCookie = document.cookie
   var cookieStart
   var end

   if (docCookie.length>0) {
      cookieStart = docCookie.indexOf(cookieName)
      if (cookieStart != -1) {
         cookieStart = cookieStart + cookieName.length
         end = docCookie.indexOf(";",cookieStart)
         if (end == -1) {
            end = docCookie.length
         }
         return unescape(docCookie.substring(cookieStart,end))
      }
   }
   return false
}

    
        window.onload = loadDeferredIframe;

    </script>



<div class="container">
    <div class="row" style="height:300px;">
      <div class="col-sm-12">

        <div id="myMap"></div>
      </div>
    </div>
    <div id="cameradetails">
        <div class="row">
            <div class="col-sm-2">           
                <span><b>Camera</b></span> <span id='title'></span>
            </div>
            <div class="col-sm-2">
                <span><b>Location</b></span> <span id='description'></span>
            </div>
            <div class="col-sm-4">
                <span><b>Latitude</b></span> <span id='latitude'></span>
            </div>
            <div class="col-sm-4">
                <span><b>Longitude</b></span> <span id='longitude'></span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            
            <iframe   scrolling="no" id="iframeid"  scrolling="auto" style="width:95%;height:600px;overflow: hidden;"  ></iframe>
        </div>
      </div> 
  </div>

  



    
</body>
</html>